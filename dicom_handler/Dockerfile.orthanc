FROM osimis/orthanc:22.10.2

RUN apt-get update && apt-get install -y lua5.4 lua5.4-dev luarocks build-essential && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

RUN luarocks install luasocket

# Copy the Lua socket modules into a directory Orthanc can read
RUN mkdir -p /etc/orthanc/lua/socket && \
    cp -r /usr/local/share/lua/5.4/socket /etc/orthanc/lua/ && \
    cp /usr/local/share/lua/5.4/ltn12.lua /etc/orthanc/lua/ && \
    cp /usr/local/share/lua/5.4/mime.lua /etc/orthanc/lua/

ENV LUA_PATH="/etc/orthanc/lua/?.lua;/etc/orthanc/lua/?/init.lua;;"
ENV LUA_CPATH="/usr/lib/lua/5.4/?.so;;"
